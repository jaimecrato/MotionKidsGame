<!-- camera.html -->
<!DOCTYPE html>
<html>
<head>
  <title>Camera Sender</title>
  <script src="https://unpkg.com/peerjs@1.5.2/dist/peerjs.min.js"></script>
</head>
<body>
  <h2>Camera App</h2>
  <video id="video" autoplay playsinline muted style="width: 100%; max-width: 400px;"></video>
  <canvas id="canvas" style="display:none"></canvas>
  <br>
  <input id="peerIdInput" placeholder="Enter Game Peer ID" />
  <button onclick="connect()">Connect</button>

  <script>
    const video = document.getElementById('video');
    const canvas = document.getElementById('canvas');
    const ctx = canvas.getContext('2d');
    let conn = null;

    const peer = new Peer();
    peer.on('open', id => {
      alert('Camera Peer ID: ' + id);
    });

    async function startCamera() {
      const stream = await navigator.mediaDevices.getUserMedia({ video: { facingMode: 'environment' } });
      video.srcObject = stream;
    }

    function connect() {
      const targetId = document.getElementById('peerIdInput').value;
      conn = peer.connect(targetId);
      conn.on('open', () => {
        console.log('Connected to game');
        setInterval(sendFrame, 200);
      });
    }

    function sendFrame() {
      if (!video.videoWidth) return;
      canvas.width = video.videoWidth;
      canvas.height = video.videoHeight;
      ctx.drawImage(video, 0, 0);
      const imgData = canvas.toDataURL('image/jpeg', 0.6);
      conn.send(imgData);
    }

    startCamera();
  </script>
</body>
</html>
